#!/usr/bin/env ruby
# frozen_string_literal: true

class ReadMeUpdater
  def initialize(links: Dir["./**/*.md"])
    @links = links
  end

  def generate_toc
    links
      .sort
      .map do |link|
        next if SKIP_FILES.include?(link)

        title = File.open(link, &:readline)[2..].strip

        format(FORMAT_STRING, title, link)
      end.join("\n")
  end

  def generate_readme
    File.write("README.md", format(DATA.read, generate_toc))
  end

  attr_reader :links

  FORMAT_STRING = "[%s](%s)"
  SKIP_FILES = [
    "README.md",
    "README.standard.md",
  ].freeze
end

ReadMeUpdater.new.generate_readme

__END__
# Abtion Guidelines
## Table of Contents
%s

## Philosophy

The guidelines are extracted from real problems we encountered and the
solutions we have found along the way. These guidelines should be used as a
default unless there is a good reason against it.

## Contribute

These guidelines are created with the help of the whole organization. Anyone is
welcome to open a PR to any section of the guidelines.

Anything added to the guideline must have been extracted from a project.
